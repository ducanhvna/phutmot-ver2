<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Cron Job for Fabric Pipeline Scheduler -->
        <record id="ir_cron_fabric_pipeline_scheduler" model="ir.cron">
            <field name="name">BTMH Fabric Pipeline Scheduler</field>
            <field name="model_id" ref="model_btmh_fabric_pipeline"/>
            <field name="state">code</field>
            <field name="code">model.cron_run_scheduled_pipelines()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">minutes</field>
            <field name="numbercall">-1</field>
            <field name="active">True</field>
            <field name="user_id" ref="base.user_root"/>
        </record>
        
        <!-- Cron Job for Data Sync Monitoring -->
        <record id="ir_cron_btmh_data_sync_monitor" model="ir.cron">
            <field name="name">BTMH Data Sync Monitor</field>
            <field name="model_id" ref="model_btmh_fabric_pipeline"/>
            <field name="state">code</field>
            <field name="code">
# Monitor and retry failed syncs
failed_pipelines = model.search([
    ('status', 'in', ['failed', 'timeout']),
    ('auto_schedule', '=', True),
    ('active', '=', True)
])

for pipeline in failed_pipelines:
    # Retry after 10 minutes for failed pipelines
    if pipeline.last_run_time and pipeline.last_run_time &lt; (fields.Datetime.now() - timedelta(minutes=10)):
        try:
            pipeline.action_trigger_pipeline()
        except Exception as e:
            pipeline.env['btmh.sync.log'].create({
                'model_name': 'btmh.fabric.pipeline',
                'record_id': pipeline.id,
                'sync_type': 'auto_retry',
                'status': 'error',
                'message': f'Auto retry failed for {pipeline.name}: {str(e)}'
            })
            </field>
            <field name="interval_number">10</field>
            <field name="interval_type">minutes</field>
            <field name="numbercall">-1</field>
            <field name="active">True</field>
            <field name="user_id" ref="base.user_root"/>
        </record>
    </data>
</odoo>
