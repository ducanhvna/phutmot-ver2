<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View for Nhat Ky Dong Bo -->
    <record id="view_btmh_nhat_ky_dong_bo_tree" model="ir.ui.view">
        <field name="name">btmh.nhat_ky_dong_bo.tree</field>
        <field name="model">btmh.nhat_ky_dong_bo</field>
        <field name="arch" type="xml">
            <tree string="Nhật Ký Đồng Bộ BTMH" decoration-success="trang_thai=='thanh_cong'" 
                  decoration-warning="trang_thai=='dang_xu_ly'" decoration-danger="trang_thai=='that_bai'">
                <field name="thoi_gian_tao"/>
                <field name="ten_model"/>
                <field name="loai_sync"/>
                <field name="trang_thai"/>
                <field name="so_ban_ghi_xu_ly"/>
                <field name="so_ban_ghi_thanh_cong"/>
                <field name="so_ban_ghi_that_bai"/>
                <field name="thoi_gian_bat_dau"/>
                <field name="thoi_gian_ket_thuc"/>
                <field name="thoi_gian_xu_ly"/>
            </tree>
        </field>
    </record>

    <!-- Form View for Nhat Ky Dong Bo -->
    <record id="view_btmh_nhat_ky_dong_bo_form" model="ir.ui.view">
        <field name="name">btmh.nhat_ky_dong_bo.form</field>
        <field name="model">btmh.nhat_ky_dong_bo</field>
        <field name="arch" type="xml">
            <form string="Nhật Ký Đồng Bộ BTMH" create="false" edit="false">
                <header>
                    <field name="trang_thai" widget="statusbar" statusbar_visible="dang_xu_ly,thanh_cong,that_bai"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="display_name"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group name="sync_info" string="Thông Tin Đồng Bộ">
                            <field name="ten_model"/>
                            <field name="id_ban_ghi" attrs="{'invisible': [('id_ban_ghi', '=', False)]}"/>
                            <field name="loai_sync"/>
                            <field name="trang_thai"/>
                        </group>
                        <group name="timing_info" string="Thời Gian">
                            <field name="thoi_gian_tao"/>
                            <field name="thoi_gian_bat_dau"/>
                            <field name="thoi_gian_ket_thuc"/>
                            <field name="thoi_gian_xu_ly"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Kết Quả" name="results">
                            <group>
                                <group name="record_counts">
                                    <field name="so_ban_ghi_xu_ly"/>
                                    <field name="so_ban_ghi_thanh_cong"/>
                                    <field name="so_ban_ghi_that_bai"/>
                                </group>
                                <group name="pipeline_info" attrs="{'invisible': [('fabric_pipeline_id', '=', False)]}">
                                    <field name="fabric_pipeline_id"/>
                                    <field name="fabric_run_id"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Thông Báo" name="messages">
                            <field name="thong_bao" readonly="1"/>
                        </page>
                        
                        <page string="Chi Tiết Lỗi" name="error_details" attrs="{'invisible': [('chi_tiet_loi', '=', False)]}">
                            <field name="chi_tiet_loi" readonly="1"/>
                        </page>
                        
                        <page string="Dữ Liệu Đồng Bộ" name="sync_data" attrs="{'invisible': [('du_lieu_dong_bo', '=', False)]}">
                            <field name="du_lieu_dong_bo" readonly="1" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        
                        <page string="Kết Quả Trả Về" name="response_data" attrs="{'invisible': [('ket_qua_tra_ve', '=', False)]}">
                            <field name="ket_qua_tra_ve" readonly="1" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_btmh_nhat_ky_dong_bo_search" model="ir.ui.view">
        <field name="name">btmh.nhat_ky_dong_bo.search</field>
        <field name="model">btmh.nhat_ky_dong_bo</field>
        <field name="arch" type="xml">
            <search string="Tìm Kiếm Nhật Ký Đồng Bộ">
                <field name="ten_model"/>
                <field name="id_ban_ghi"/>
                <field name="fabric_run_id"/>
                <separator/>
                <filter name="dang_xu_ly" string="Đang Xử Lý" domain="[('trang_thai', '=', 'dang_xu_ly')]"/>
                <filter name="thanh_cong" string="Thành Công" domain="[('trang_thai', '=', 'thanh_cong')]"/>
                <filter name="that_bai" string="Thất Bại" domain="[('trang_thai', '=', 'that_bai')]"/>
                <separator/>
                <filter name="auto_sync" string="Tự Động" domain="[('loai_sync', '=', 'auto')]"/>
                <filter name="manual_sync" string="Thủ Công" domain="[('loai_sync', '=', 'manual')]"/>
                <filter name="fabric_sync" string="Fabric" domain="[('loai_sync', '=', 'fabric')]"/>
                <separator/>
                <filter name="sales_data" string="Doanh Thu" domain="[('ten_model', '=', 'btmh.doanh_thu.ban_hang')]"/>
                <filter name="payment_data" string="Thanh Toán" domain="[('ten_model', '=', 'btmh.chung_tu.thanh_toan')]"/>
                <filter name="deposit_data" string="Đặt Cọc" domain="[('ten_model', '=', 'btmh.dat_coc')]"/>
                <filter name="balance_data" string="Dư Đầu Ngày" domain="[('ten_model', '=', 'btmh.du_dau_ngay')]"/>
                <separator/>
                <filter name="today" string="Hôm Nay" domain="[('thoi_gian_tao', '>=', context_today().strftime('%Y-%m-%d 00:00:00'))]"/>
                <filter name="this_week" string="Tuần Này" domain="[('thoi_gian_tao', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d 00:00:00'))]"/>
                <filter name="this_month" string="Tháng Này" domain="[('thoi_gian_tao', '>=', (context_today().replace(day=1)).strftime('%Y-%m-%d 00:00:00'))]"/>
                <group expand="0" string="Group By">
                    <filter name="group_by_date" string="Ngày" context="{'group_by': 'thoi_gian_tao:day'}"/>
                    <filter name="group_by_model" string="Model" context="{'group_by': 'ten_model'}"/>
                    <filter name="group_by_sync_type" string="Loại Sync" context="{'group_by': 'loai_sync'}"/>
                    <filter name="group_by_status" string="Trạng Thái" context="{'group_by': 'trang_thai'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_btmh_nhat_ky_dong_bo" model="ir.actions.act_window">
        <field name="name">Nhật Ký Đồng Bộ BTMH</field>
        <field name="res_model">btmh.nhat_ky_dong_bo</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_btmh_nhat_ky_dong_bo_search"/>
        <field name="context">{'create': False}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Chưa có nhật ký đồng bộ nào
            </p>
            <p>
                Nhật ký đồng bộ sẽ tự động được tạo khi có quá trình đồng bộ dữ liệu từ BTMH.
            </p>
        </field>
    </record>
</odoo>
